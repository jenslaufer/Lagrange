---
title: "Untitled"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Lessons learned from scraping


> "Data is the new oil. It's valuable, but if unrefined it cannot really be used. It has to be changed into gas, plastic, chemicals, etc to create a valuable entity that drives profitable activity; so must data be broken down, analyzed for it to have value." 
-- <cite>Clive Humby</cite>

I scraped a lot websites in the last years to retrieve data for my data science projects. I want to share some insights I ot from this.

1. __Check the Legal Stuff__
      
Before you scrape a website __ALWAYS__ check the _Terms of Service_ of the Site and the robots.txt, which content you are allowed to fetch and which not. This saves you a lot of trouble and the risk of getting sued. Remember that get the data with scraping is a bit of grey zone.

2, __Scrape every resource just once__

I try to scrape each resource just once. Just once!
You don't want to download the same resource over and over again, especially during development. We all have kind of trial and error style. So you write a bit of code and you test if it works or not. When scraping a site und you try out diffrent headers and URLs and it's parameters you risk to get blocked already. Especially the big famous website, just block you quicker than you think. The block is sometimes just for a few hours, but I am sure the log the IP somewhere, which you should you avoid.
Keep this in  ind:

    - You don't want to send too useless requests to a website. It's also a kind of respect to value data the website offers you.
    - You don't want to get blocked or banned as said before

Implement a flag that you are able to force the resource can be downloaded when it is outdated. Oudated means for me several weeks rather than several hours. This depends for sure also what you want to do. If you need the data more often, try to scrape with more proxies.
    
3. __Always keep the raw files (the raw oil!)__

In 2. I wrote that you should try to avoid scraping the resource to often. Therefore it's essential to always keep the raw file once it is scraped. Ofen you are interested in data you werent't interested first. The raw files are like diamonds or the raw oil and very valuable. So your steps:

1. Write a dump scraper and save the downloaded file
2. Always write the Parser in the second step, when you enough raw files.

Another advantage of having the raw that you can throw the extracted data away in case your parsing sucks.

This way you can start your scraping project even before you know what data you interested in details.  This saves a lot of time.

4. __Always use first class proxies for scraping__

Use proxies already during development. This saves you a lot of troubles. My rule of thumb 10 proxies per scraping process/thread.

5. __Use a database for te raw files__

Save the raw file in a database. I love MongoDB's GridFS for this. You have diffrent andvantages with this:

- You are able to save metadata with the file (e.g scraping date, search query). Example: Airbnb
- You can have a history of raw files for resource (very valuable)

6. __Use a database for the raw files__

Use a database for the scraped data. With databases you able to group data. MongoDB is very valuable here, as you don't need a scheme, you can just save the data as it is. Especially if you able to scrape from an internal API. From Apis you get JSON and you are able to save the Json just like it is into the MongoDB.

7. __Do a data anaylsis on the parsed data__

Always check for percentage 

- Software design by busines use case not techncailly like scrapy
- Check the results with data anlysis
- Scraping is itereative process (check data analyis)
- Use a datbase for the raw files instead of filesystem
  - metadata
  - history
- Use a database for parsed data
- MongoDB! From Apis you get often json which can be persisted 1-1
- MongoDB GridFS
- Invest if there is an underlying API you can use instead of pasring HTML
- Rotate useragents (-> github project of mine)