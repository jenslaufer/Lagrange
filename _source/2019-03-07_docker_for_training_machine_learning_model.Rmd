---
title: "Docker container to train machine learning models"
output: html_document
---

We 

I wrote n article about using docker to retrieve data with web scraping. I also wrote an article about using docker for data science. This time 
I want to show you how to use a docker container for teaching machine learning models. I want to concentrate on the trainig of a convolulational neurarl network as they very resource intensive and you use GPU. This is not supported out of the box by Docker as docker uses an absraction layer for the operating system and GPU is actually too low level. But there is a solution for this a NVIDIA created it's own nvidia docker.


```Docker 

FROM tensorflow/tensorflow:latest-gpu-py3

# Install system packages
RUN apt-get update && apt-get install -y --no-install-recommends \
      bzip2 \
      g++ \
      git \
      graphviz \
      libgl1-mesa-glx \
      libhdf5-dev \
      openmpi-bin \
      wget && \
    rm -rf /var/lib/apt/lists/*

COPY src /src
COPY entrypoints /src/entrypoints

WORKDIR /src

RUN pip install -r requirements.txt

ENV PYTHONPATH='/src/:$PYTHONPATH'

ENTRYPOINT ["entrypoints/entrypoint.train.gpu.sh"]

```



Entry point 

```bash

# start training
python -W ignore -m trainer.train -j /src/$TRAIN_JOB_DIR -i /src/images

# copy train output to s3
aws s3 cp /src/$TRAIN_JOB_DIR s3://$S3_BUCKET/$TRAIN_JOB_DIR --recursive

```

We use a the latest tensorflow docker image with GPU support.

### Docker machine?

```code
aws configure
```

```code
docker-machine create --driver amazonec2 \
                      --amazonec2-region eu-west-1 \
                      --amazonec2-ami ami-58d7e821 \
                      --amazonec2-instance-type p2.xlarge \
                      --amazonec2-vpc-id vpc-abc \
                      ec2-p2
```


```code

docker-machine ssh ec2-p2
```